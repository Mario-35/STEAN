"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatLog=exports.writeToLog=void 0;const util_1=__importDefault(require("util")),constants_1=require("../constants"),fs_1=__importDefault(require("fs"));var writeToLog_1=require("./writeToLog");Object.defineProperty(exports,"writeToLog",{enumerable:!0,get:function(){return writeToLog_1.writeToLog}});class FormatLog{debugFile=!1;line=t=>"=".repeat(t);logAll=(t,o)=>"object"==typeof t?util_1.default.inspect(t,{showHidden:!1,depth:null,colors:o||!1}):t;separator=(t,o)=>`${(0,constants_1.color)(32)} ${this.line(o)} ${(0,constants_1.color)(33)} ${t} ${(0,constants_1.color)(32)} `+this.line(o)+(0,constants_1.color)(0);logCleInfos=(t,o)=>`${(0,constants_1.color)(32)} ${t} ${(0,constants_1.color)(37)} : ${(0,constants_1.color)(36)} `+this.logAll(o,this.debugFile)+(0,constants_1.color)(0);constructor(){console.log=t=>{t&&process.env.NODE_ENV?.trim()!==constants_1.TEST&&this.write(t)}}write(t){process.stdout.write(util_1.default.format.apply(null,[t])+"\n")}object(t,o){if(constants_1._DEBUG){const s=[this.head(t)];return Object.keys(o).forEach(t=>{s.push(this.logCleInfos("  "+t,o[t]))}),s.join("\n")}}url(t){return`${constants_1._WEB} ${(0,constants_1.color)(39)} : ${(0,constants_1.color)(36)} `+t+(0,constants_1.color)(0)}head(t,o){if(constants_1._DEBUG)return o?`${(0,constants_1.color)(32)} ${this.line(12)} ${(0,constants_1.color)(36)} ${t} ${(0,constants_1.color)(37)} ${this.logAll(o,this.debugFile)} ${(0,constants_1.color)(32)} `+this.line(12)+(0,constants_1.color)(0):this.separator(t,12)}infos(t,o){if(constants_1._DEBUG)return`${this.separator(t,30)} ${(0,constants_1.color)(33)} `+this.logAll(o,!0)+(0,constants_1.color)(0)}debug(t,o){if(constants_1._DEBUG)return`${(0,constants_1.color)(32)} ${t} ${(0,constants_1.color)(37)} : ${(0,constants_1.color)(36)} `+this.logAll(o,this.debugFile)+(0,constants_1.color)(0)}result(t,o){if(constants_1._DEBUG)return`${(0,constants_1.color)(32)}     >>${(0,constants_1.color)(30)} ${t} ${(0,constants_1.color)(39)} : ${(0,constants_1.color)(36)} `+this.logAll(o,this.debugFile)+(0,constants_1.color)(0)}error(t,o){return o?`${(0,constants_1.color)(31)} ${t} ${(0,constants_1.color)(34)} : ${(0,constants_1.color)(33)} `+this.logAll(o,this.debugFile)+(0,constants_1.color)(0):`${(0,constants_1.color)(31)} Error ${(0,constants_1.color)(34)} : ${(0,constants_1.color)(33)} `+this.logAll(t)+(0,constants_1.color)(0)}whereIam(t){t=t?(0,constants_1.color)(39)+` ${t} `+(0,constants_1.color)(0):"";if(constants_1._DEBUG)return`${(0,constants_1.color)(31)} ${this.line(4)} ${(0,constants_1.color)(36)} ${(new Error).stack?.split("\n")[2].trim().split("(")[0].split("at ")[1].trim()} ${t}${(0,constants_1.color)(31)} `+this.line(4)+(0,constants_1.color)(0)}test(){return`${(0,constants_1.color)(33)} ${this.line(4)} ${(0,constants_1.color)(36)} ${(new Error).stack?.split("\n")[2].trim().split(" ")[1]} ${(0,constants_1.color)(33)} `+this.line(4)+(0,constants_1.color)(0)}writeErrorInFile(t,...o){var s=fs_1.default.createWriteStream(constants_1._ERRORFILE,{flags:"a"});t?(s.write(`# ${(0,constants_1.TIMESTAMP)()} : ${t.request.url}
`),s.write(util_1.default.inspect(t.request.body,{showHidden:!1,depth:null,colors:!1})+"\n"),s.write(this.line(30)+`
`)):s.write(`# ${this.line(10)} ${(0,constants_1.TIMESTAMP)()} ${this.line(10)}
`),s.write(util_1.default.format.apply(null,o)+"\n")}}exports.formatLog=new FormatLog;