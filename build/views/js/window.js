function Window(h,m){"use strict";var u=this,f=null,p=(m.lang,Window.count++),_=!0,n={},g=WindowState.HIDDEN,y=WindowState.NORMAL,s={width:0,height:0},o={x:0,y:0},W={x:0,y:0},a={x:0,y:0},d=null,z={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize",nw:"nwse-resize"},v=!1,r=!1;if(this.content=null,"string"!=typeof h)throw new Error("Parameter 1 must be of type string");if(void 0!==m){if("object"!=typeof m)throw new Error("Parameter 2 must be of type object");if((y=WindowUtil.getProperty(m,"state",WindowState.NORMAL))!=WindowState.NORMAL&&y!=WindowState.MAXIMIZED)throw new Error("'state' must be WindowState.NORMAL or WindowState.MAXIMIZED")}else m={};function L(e){WindowUtil.getProperty(m,"resizable",!0)&&(r=!0,f.classList.add("window_resizing"),d=e.target.getAttribute("data-resize"),document.body.style.cursor=z[d],a.x=e.clientX,a.y=e.clientY,f.classList.add("window_no_animation"),document.addEventListener("mouseup",w),document.addEventListener("mousemove",t),document.body.classList.add("text_not_selectable"),u.on("resize_start")(e))}function w(e){e&&e.preventDefault(),m.position.y<=0&&u.maximize(),document.body.style.cursor="",f.classList.remove("window_no_animation"),f.classList.remove("window_resizing"),r=!1,document.removeEventListener("mouseup",w),document.removeEventListener("mousemove",t),document.body.classList.remove("text_not_selectable"),u.on("resize_stop")(e)}function t(e){var t,i,n,o;e.preventDefault(),0==r?w():(i=t=0,n=WindowUtil.getProperty(m,"min_size",{width:200,height:150}),o=WindowUtil.getProperty(m,"max_size",""),"nw"!=d&&"n"!=d&&"ne"!=d||(s.height>n.height||e.clientY<m.position.y)&&(i=-(a.y-e.clientY),n.height<=s.height-i)&&(""==o||o.height>=s.height-i)&&(m.position.y+=i),"ne"!=d&&"e"!=d&&"se"!=d||(s.width>n.width||e.clientX>m.position.x+s.width)&&(t=a.x-e.clientX),"sw"!=d&&"s"!=d&&"se"!=d||(s.height>n.height||e.clientY>m.position.y+s.height)&&(i=a.y-e.clientY),"nw"!=d&&"w"!=d&&"sw"!=d||(s.width>n.width||e.clientX<m.position.x)&&(t=-(a.x-e.clientX),n.width<=s.width-t)&&(""==o||o.width>=s.width-t)&&(m.position.x+=t),"nw"!=d&&"n"!=d&&"ne"!=d&&"w"!=d&&"sw"!=d||I(),a.x=e.clientX,a.y=e.clientY,u.changeOption("size",{width:s.width-t,height:s.height-i}),N(),u.on("resize")(e))}function b(e){var t,i;r||(u.isNormalSized()||(f.classList.add("window_no_animation"),u.normalSize(),t=f.getElementsByClassName("window_bar")[0],u.changeOption("position",{x:e.clientX-t.offsetWidth/2,y:e.clientY-t.offsetHeight/2}),f.classList.remove("window_no_animation")),e.preventDefault(),0==v?E():(t=W.x-e.clientX,i=W.y-e.clientY,W.x=e.clientX,W.y=e.clientY,u.changeOption("position",{x:f.offsetLeft-t,y:f.offsetTop-i}),I(),u.on("move")(e)))}function E(e){e&&e.preventDefault(),f.classList.remove("window_moving"),m.position.y<=0&&u.maximize(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",E),u.on("move_stop")(e)}function S(e){f.classList.remove("window_maximized");var t=f.getElementsByClassName("window_button_toggle_maximize")[0];e===WindowState.MAXIMIZED?(f.classList.add("window_maximized"),t.innerHTML=WindowUtil.getProperty(m,"normalsize_icon","&#10697;")):(WindowState.NORMAL,t.innerHTML=WindowUtil.getProperty(m,"maximize_icon","&#9744;"))}function x(e){switch(f.classList.remove("window_hidden"),f.classList.remove("window_minimized"),e){case WindowState.HIDDEN:f.classList.add("window_hidden");break;case WindowState.MINIMIZED:f.classList.add("window_minimized");break;case WindowState.SHOWN:}}function N(){var e,t,i,n;_&&(""==(i=WindowUtil.getProperty(m,"size",""))&&(m.size={width:200,height:150},i=m.size),e={width:m.size.width,height:m.size.height},s.width=WindowUtil.getProperty(i,"width",200),s.height=WindowUtil.getProperty(i,"height",150),i=WindowUtil.getProperty(m,"min_size",{width:200,height:150}),n=WindowUtil.getProperty(m,"max_size",""),""!=i&&(t=WindowUtil.getProperty(i,"width",""),i=WindowUtil.getProperty(i,"height",""),""!=t&&s.width<t&&(s.width=t,m.size.width=s.width),""!=i)&&s.height<i&&(s.height=i,m.size.height=s.height),""!=n&&(t=WindowUtil.getProperty(n,"width",""),i=WindowUtil.getProperty(n,"height",""),""!=t&&s.width>t&&(s.width=t,m.size.width=s.width),""!=i)&&s.height>i&&(s.height=i,m.size.height=s.height),n=f.parentElement,s.height>n.offsetHeight&&(s.height=n.offsetHeight,m.size.height=s.height,m.position.y=0),s.width>n.offsetWidth&&(s.width=n.offsetWidth,m.size.width=s.width,m.position.x=0),f.style.width=s.width+"px",f.style.height=s.height+"px",I(),u.on("update_size")({old_size:e,new_size:s}))}function M(){_&&(u.on("update_selected")(),(WindowUtil.getProperty(m,"selected",!1)?(f.classList.add("window_selected"),u.on("select")):(f.classList.remove("window_selected"),u.on("deselect")))())}function I(){var e,t,i;_&&(e=f.parentElement,"number"!=typeof m.position.x&&(m.position.x=e.offsetWidth/2-f.offsetWidth/2),"number"!=typeof m.position.y&&(m.position.y=e.offsetHeight/2-f.offsetHeight/2),t=m.position,i={x:m.position.x,y:m.position.y},o.x=WindowUtil.getProperty(t,"x",0),o.y=WindowUtil.getProperty(t,"y",0),o.x<0&&(o.x=0),o.y<0&&(o.y=0),o.x>e.offsetWidth-f.offsetWidth&&(o.x=e.offsetWidth-f.offsetWidth,m.position.x=o.x),o.y>e.offsetHeight-f.offsetHeight&&(o.y=e.offsetHeight-f.offsetHeight,m.position.y=o.y),f.style.left=o.x+"px",f.style.top=o.y+"px",u.on("update_position")({old_position:i,new_position:o}))}function P(){for(var e=WindowUtil.getProperty(m,"events",{}),t=Object.keys(e),i=0;i<t.length;i++)n[t[i]]=e[t[i]]}function D(){_&&(WindowUtil.getProperty(m,"bar_visible",!0)?f.classList.remove("window_bar_hidden"):f.classList.add("window_bar_hidden"))}function O(){WindowUtil.getProperty(m,"resizable",!0)?f.classList.remove("window_not_resizable"):f.classList.add("window_not_resizable")}function H(){WindowUtil.getProperty(m,"movable",!0)?f.classList.remove("window_not_movable"):f.classList.add("window_not_movable")}function U(){WindowUtil.getProperty(m,"maximizable",!0)?f.classList.remove("window_not_maximizable"):f.classList.add("window_not_maximizable")}function C(){WindowUtil.getProperty(m,"minimizable",!0)?f.classList.remove("window_not_minimizable"):f.classList.add("window_not_minimizable")}function A(){WindowUtil.getProperty(m,"always_on_top",!1)?f.classList.add("window_alway_on_top"):f.classList.remove("window_alway_on_top")}"object"!=typeof m.position&&(m.position={}),this.getTitle=function(){if(_)return h},this.setTitle=function(e){if(_){if("string"!=typeof e)throw new Error("Parameter 1 must be of type string");u.on("change_title")({old_title:h,new_title:e}),h=e,null!==typeof f&&(f.getElementsByClassName("window_title")[0].innerHTML=h)}},this.getContainer=function(){if(_)return f},this.changeOption=function(e,t){if(_){if("string"!=typeof e)throw new Error("Parameter 1 must be of type string");if(void 0===t)throw new Error("Parameter 2 must be set");if(m[e]=t,null!=f)switch(e){case"icon":f.getElementsByClassName("window_icon")[0].innerHTML=t;break;case"minimize_icon":f.getElementsByClassName("window_button_minimize")[0].innerHTML=t;break;case"maximize_icon":case"normalsize_icon":S(y);break;case"close_icon":f.getElementsByClassName("window_button_close")[0].innerHTML=t;break;case"size":N();break;case"position":I();break;case"selected":M();break;case"min_size":case"max_size":N();break;case"events":P();break;case"bar_visible":D();break;case"resizable":O();break;case"movable":H();break;case"maximizable":U();break;case"minimizable":C();break;case"always_on_top":A();break;default:this.reload()}}},this.getOptions=function(){if(_)return m},this.reload=function(){_=!0,WindowUtil.getProperty(m,"container",null)!==f&&null!=f&&(f.remove(),f=null),null==f&&(e=WindowUtil.getProperty(m,"container",document.body),(f=document.createElement("div")).className="window",f.id="window_"+p,f.window=u,e.appendChild(f)),N(),I(),M(),P(),D(),O(),H(),U(),C(),A(),x(g=WindowUtil.getProperty(m,"window_state",WindowState.SHOWN)),f.innerHTML="";for(var i=document.createElement("div"),e=(i.className="window_bar",document.createElement("span")),t=(e.className="window_icon",e.innerHTML=WindowUtil.getProperty(m,"icon",""),document.createElement("span")),n=(t.className="window_title",t.innerHTML=h,document.createElement("div")),o=(n.className="window_toggle_buttons",document.createElement("span")),s=(o.className="window_button_minimize",o.innerHTML=WindowUtil.getProperty(m,"minimize_icon","_"),document.createElement("span")),a=(s.className="window_button_toggle_maximize",document.createElement("span")),d=(a.className="window_button_close",a.innerHTML=WindowUtil.getProperty(m,"close_icon","&#9587;"),n.appendChild(o),n.appendChild(s),n.appendChild(a),i.appendChild(e),i.appendChild(t),i.appendChild(n),f.appendChild(i),[]),r=["n","ne","e","se","s","sw","w","nw"],w=0;w<8;w++){var l=document.createElement("div");l.className="window_resize_handle window_resize_handle_"+r[w],l.setAttribute("data-resize",r[w]),l.addEventListener("mousedown",L),l.style.cursor=z[r[w]],d.push(l),f.appendChild(l)}S(y),null==this.content&&(this.content=document.createElement("div"),this.content.className="window_content"),f.appendChild(this.content);var c=0;i.addEventListener("mousedown",function(e){if(0==e.button){if(v=!0,WindowUtil.getProperty(m,"movable",!0)){for(var t=e.target;t!=i;){if(t==o||t==s||t==a)return;t=t.parentElement}e.preventDefault(),W.x=e.clientX,W.y=e.clientY,f.classList.add("window_moving"),document.addEventListener("mousemove",b),document.addEventListener("mouseup",E)}1==++c&&setTimeout(function(){1==c?u.on("move_start")(e):u.toggleMaximize(),c=0},Window.DOUBLE_CLICK_DELAY)}}),i.addEventListener("mouseup",function(e){0==e.button&&(v=!1)}),o.addEventListener("click",function(e){e.preventDefault(),u.minimize()}),s.addEventListener("click",function(e){e.preventDefault(),u.toggleMaximize()}),a.addEventListener("click",function(e){e.preventDefault(),u.close()}),P(),u.on("reload")()},this.changeState=function(e){if(_){if(e!=WindowState.NORMAL&&e!=WindowState.MAXIMIZED)throw new Error("Parameter 1 must be WindowState.NORMAL or WindowState.MAXIMIZED");u.on("change_state")({old_state:y,new_state:e}),S(y=e)}},this.changeWindowState=function(e){if(_){if(e!=WindowState.MINIMIZED&&e!=WindowState.HIDDEN&&e!=WindowState.SHOWN)throw new Error("Parameter 1 must be WindowState.HIDDEN or WindowState.MINIMIZED or WindowState.SHOWN");u.on("change_window_state")({old_window_state:g,new_window_state:e}),x(g=e)}},this.minimize=function(){_&&WindowUtil.getProperty(m,"minimizable",!0)&&!1!==u.on("minimizing")&&(this.changeWindowState(WindowState.MINIMIZED),u.on("minimize")())},this.normalSize=function(){_&&(this.changeState(WindowState.NORMAL),u.on("normalSize")())},this.maximize=function(){_&&WindowUtil.getProperty(m,"maximizable",!0)&&!1!==u.on("maximizing")&&(this.changeState(WindowState.MAXIMIZED),N(),u.on("maximize")())},this.toggleMaximize=function(){_&&(y==WindowState.NORMAL?u.maximize():u.normalSize())},this.hide=function(){_&&(this.changeWindowState(WindowState.HIDDEN),u.on("hide")())},this.show=function(){_&&(this.changeWindowState(WindowState.SHOWN),u.on("show")())},this.on=function(e,t){if(_)return void 0===t?"function"==typeof n[e]?n[e]:function(){}:void(n[e]=t)},this.removeOn=function(e){_&&delete n[e]},this.getState=function(){if(_)return y},this.getWindowState=function(){if(_)return g},this.getSize=function(){if(_)return s},this.getPosition=function(){if(_)return o},this.isMinimized=function(){if(_)return g==WindowState.MINIMIZED},this.isHidden=function(){if(_)return g==WindowState.HIDDEN},this.isShown=function(){if(_)return g==WindowState.SHOWN},this.isVisible=function(){if(_)return!(this.isMinimized()||this.isHidden())},this.isMaximized=function(){if(_)return y==WindowState.MAXIMIZED},this.isNormalSized=function(){if(_)return y==WindowState.NORMAL},this.isSelected=function(){if(_)return WindowUtil.getProperty(m,"selected",!1)},this.reset=function(){_&&(this.show(),this.normalSize(),u.on("reset")())},this.close=function(){var e=WindowUtil.getProperty(m,"close_action",Window.DISPOSE_ON_CLOSE);_&&e!=Window.DO_NOTHING_ON_CLOSE&&!1!==u.on("closing")()&&(this.hide(),u.on("closed")(),e==Window.DISPOSE_ON_CLOSE)&&this.dispose()},this.dispose=function(){!1!==u.on("disposing")()&&(this.content.remove(),this.content=null,f.remove(),f=null,u.on("disposed")(),_=!1)},this.reload(),u.on("init")()}Window.count=0,Window.DISPOSE_ON_CLOSE=0,Window.HIDE_ON_CLOSE=1,Window.DO_NOTHING_ON_CLOSE=2,Window.DOUBLE_CLICK_DELAY=300;const WindowState={NORMAL:0,MAXIMIZED:1,MINIMIZED:2,SHOWN:3,HIDDEN:4},WindowUtil={getProperty:function(e,t,i){return void 0!==e[t]?e[t]:i}};