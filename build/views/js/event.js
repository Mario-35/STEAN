function addToResultList(e,t,a){var n=document.createElement("li"),e=(n.innerText=e+": ",document.createElement("span"));e.className="json-literal",e.innerText=t,n.appendChild(e),getElement("listResult").appendChild(n),a&&addToResultList("--\x3e",a)}function prepareForm(){var e;!0===importFile&&(e=jsonDatas.innerText.replace(/[^\x00-\x7F]/g,""),datas.innerText=e,document.getElementById("actionForm").requestSubmit())}submit.onclick=()=>{wait(!0);try{var e=jsonDatas.innerText.replace(/[^\x00-\x7F]/g,"");datas.innerText=e,document.getElementById("actionForm").requestSubmit()}catch(e){}},services.addEventListener("change",()=>{window.location.href=_PARAMS.services[services.value].root+"/Query"}),expandOption.addEventListener("exit",()=>{show(subExpandOption),populateMultiSelect("subExpandOption",getRelationsList(expandOption.value))}),preview.onclick=()=>{updateWinJsonResult(jsonDatas.innerText,"Preview datas")},logout.onclick=()=>{window.location.href=`${optHost.value}/${optVersion.value}/logout`},info.onclick=()=>{window.location.href=`${optHost.value}/${optVersion.value}/status`},doc.onclick=()=>{var e=optHost.value.split("/");e.pop(),window.location.href=e.join("/")},git.onclick=()=>{window.location.href="https://github.com/Mario-35/STEAN"},debug.onclick=()=>{(isDebug=!isDebug)?debug.classList.add("debug"):debug.classList.remove("debug")},btnShowLinks.onclick=()=>{var e=createUrl();updateWinLinks(JSON.parse(` { "direct" : "${e.direct}", "query" : "${e.query}"}`))},btnPostTemplate.onclick=()=>{const t=1==importFile?JSON.stringify({header:!0,nan:!0,duplicates:!0,columns:{1:{datastream:"1",featureOfInterest:"1"}}}):{};Object.keys(_PARAMS._DATAS[entityOption.value].columns).forEach(e=>{if(_PARAMS._DATAS[entityOption.value].columns[e].type)switch(_PARAMS._DATAS[entityOption.value].columns[e].type.split(":")[0]){case"json":t[e]={};break;case"relation":t[e.split("_id")[0]]={"@iot.id":-1};break;case"text":t[e]=""}}),beautifyDatas(getElement("jsonDatas"),t,"json")},btnRoot.onclick=async()=>{var e=`${optHost.value}/${optVersion.value}/`,t=await getFetchDatas(e,"GET");updateWinJsonResult(t,"[GET]:"+e)},btnClear.onclick=()=>{datas.innerText="",buttonGo()},go.onclick=async e=>{wait(!0),e&&e.preventDefault();var t=getElement("tablewrapper");if(t)for(;t.firstChild;)t.removeChild(t.lastChild);two.classList.remove("scrolling");var a,n=createUrl().direct;switch(methodOption.value){case"GET":if("graph"===resultFormatOption.value)window.open(n),wait(!1);else{var i=await getFetchDatas(n,resultFormatOption.value);try{"sql"===resultFormatOption.value?updateWinSqlQuery(i):"csv"===resultFormatOption.value?updateWinCsvResult(i):"graph"===resultFormatOption.value?updateWinGraph(i):"logs"===resultFormatOption.value?updateWinLogs(i):updateWinJsonResult(i,`[${methodOption.value}]:`+n)}catch(e){notifyError("Error",e)}finally{wait(!1)}}break;case"POST":case"PATCH":"createDB"===entityOption.value?(a=await(i=await fetch(`${optHost.value}/${optVersion.value}/createDB`,{method:"POST",headers:{"Content-Type":"application/json"},body:jsonDatas.innerText})).text(),401==i.status&&(window.location.href=_PARAMS.decodedUrl.root+"/login"),wait(!1),updateWinJsonResult(JSON.parse(a),`[${methodOption.value}]:`+n)):(a=await(i=await fetch(n,{method:methodOption.value,headers:{"Content-Type":"application/json"},body:jsonDatas.innerText})).json(),401==i.status&&(window.location.href="/login"),wait(!1),updateWinJsonResult(a,`[${methodOption.value}]:`+n));break;case"DELETE":try{(idOption.value&&0<Number(idOption.value)||"Loras"===entityOption.value&&""!==idOption.value)&&(204==(await fetch(n,{method:"DELETE",headers:{"Content-Type":"application/json"}})).status?notifyAlert("Delete",`delete ${entityOption.value} id : `+idOption.value):notifyError("Error",`delete ${entityOption.value} id : `+idOption.value))}catch(e){notifyError("Error",e)}finally{wait(!1)}}},idOption.addEventListener("change",()=>{updateForm()}),idOption.addEventListener("exit",()=>{refresh()}),entityOption.addEventListener("change",()=>{refresh_entity(),refresh()}),subentityOption.addEventListener("change",()=>{refresh()}),propertyOption.addEventListener("change",()=>{updateForm()}),resultFormatOption.addEventListener("change",()=>{updateForm()}),fileone.addEventListener("change",e=>{header("fileone");var t="";try{(t=this.files&&1<this.files.length?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value.split("\\").pop())?(fileonelabel.querySelector("span").innerHTML=t,methodOption.value="POST",importFile=!0):fileonelabel.innerHTML=labelVal}catch(e){notifyError("Error",e)}finally{buttonGo()}});