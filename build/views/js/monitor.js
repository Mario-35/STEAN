Chart.defaults.global.defaultFontSize=8,Chart.defaults.global.animation.duration=500,Chart.defaults.global.legend.display=!1,Chart.defaults.global.elements.line.backgroundColor="rgba(0,0,0,0)",Chart.defaults.global.elements.line.borderColor="rgba(0,0,0,0.9)",Chart.defaults.global.elements.line.borderWidth=2;var host=location.protocol+"//"+location.hostname+":SOCKET_PORT",socket=io(host),defaultSpan=0,spans=[],defaultDataset={label:"",data:[],lineTension:.2,pointRadius:0},defaultOptions={scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",time:{unitStepSize:30},gridLines:{display:!1}}]},tooltips:{enabled:!1},responsive:!0,maintainAspectRatio:!1,animation:!1},createChart=function(t,a){return new Chart(t,{type:"line",data:{labels:[],datasets:a},options:defaultOptions})},addTimestamp=function(t){return t.timestamp},cpuDataset=[Object.create(defaultDataset)],memDataset=[Object.create(defaultDataset)],loadDataset=[Object.create(defaultDataset)],responseTimeDataset=[Object.create(defaultDataset)],rpsDataset=[Object.create(defaultDataset)],cpuStat=document.getElementById("cpuStat"),memStat=document.getElementById("memStat"),loadStat=document.getElementById("loadStat"),responseTimeStat=document.getElementById("responseTimeStat"),rpsStat=document.getElementById("rpsStat"),cpuChartCtx=document.getElementById("cpuChart"),memChartCtx=document.getElementById("memChart"),loadChartCtx=document.getElementById("loadChart"),responseTimeChartCtx=document.getElementById("responseTimeChart"),rpsChartCtx=document.getElementById("rpsChart"),cpuChart=createChart(cpuChartCtx,cpuDataset),memChart=createChart(memChartCtx,memDataset),loadChart=createChart(loadChartCtx,loadDataset),responseTimeChart=createChart(responseTimeChartCtx,responseTimeDataset),rpsChart=createChart(rpsChartCtx,rpsDataset),charts=[cpuChart,memChart,loadChart,responseTimeChart,rpsChart],onSpanChange=function(t){t.target.classList.add("active"),defaultSpan=parseInt(t.target.id);for(var a=document.getElementsByTagName("span"),e=0;e<a.length;e++)a[e]!==t.target&&a[e].classList.remove("active");socket.emit("change")};socket.on("start",function(t){t[defaultSpan].responses.pop(),t[defaultSpan].os.pop(),cpuStat.textContent=t[defaultSpan].os[t[defaultSpan].os.length-1].cpu.toFixed(1)+"%",cpuChart.data.datasets[0].data=t[defaultSpan].os.map(function(t){return t.cpu}),cpuChart.data.labels=t[defaultSpan].os.map(addTimestamp),memStat.textContent=t[defaultSpan].os[t[defaultSpan].os.length-1].memory.toFixed(1)+"MB",memChart.data.datasets[0].data=t[defaultSpan].os.map(function(t){return t.memory}),memChart.data.labels=t[defaultSpan].os.map(addTimestamp),loadStat.textContent=t[defaultSpan].os[t[defaultSpan].os.length-1].load[defaultSpan].toFixed(2),loadChart.data.datasets[0].data=t[defaultSpan].os.map(function(t){return t.load[0]}),loadChart.data.labels=t[defaultSpan].os.map(addTimestamp),responseTimeStat.textContent=t[defaultSpan].responses[t[defaultSpan].responses.length-1].mean.toFixed(2)+"ms",responseTimeChart.data.datasets[0].data=t[defaultSpan].responses.map(function(t){return t.mean}),responseTimeChart.data.labels=t[defaultSpan].responses.map(addTimestamp),2<=t[defaultSpan].responses.length&&(a=t[defaultSpan].responses[t[defaultSpan].responses.length-1].timestamp-t[defaultSpan].responses[t[defaultSpan].responses.length-2].timestamp,rpsStat.textContent=(t[defaultSpan].responses[t[defaultSpan].responses.length-1].count/a*1e3).toFixed(2),rpsChart.data.datasets[0].data=t[defaultSpan].responses.map(function(t){return t.count/a*1e3}),rpsChart.data.labels=t[defaultSpan].responses.map(addTimestamp)),charts.forEach(function(t){t.update()});var a,s=document.getElementById("span-controls");t.length!==spans.length&&(t.forEach(function(t,a){spans.push({retention:t.retention,interval:t.interval});var e=document.createElement("span"),t=document.createTextNode(t.retention*t.interval/60+"M");e.appendChild(t),e.setAttribute("id",a),e.onclick=onSpanChange,s.appendChild(e)}),document.getElementsByTagName("span")[0].classList.add("active"))}),socket.on("stats",function(t){var a;t.retention===spans[defaultSpan].retention&&t.interval===spans[defaultSpan].interval&&(cpuStat.textContent=t.os.cpu.toFixed(1)+"%",cpuChart.data.datasets[0].data.push(t.os.cpu),cpuChart.data.labels.push(t.os.timestamp),memStat.textContent=t.os.memory.toFixed(1)+"MB",memChart.data.datasets[0].data.push(t.os.memory),memChart.data.labels.push(t.os.timestamp),loadStat.textContent=t.os.load[0].toFixed(2),loadChart.data.datasets[0].data.push(t.os.load[0]),loadChart.data.labels.push(t.os.timestamp),responseTimeStat.textContent=t.responses.mean.toFixed(2)+"ms",responseTimeChart.data.datasets[0].data.push(t.responses.mean),responseTimeChart.data.labels.push(t.responses.timestamp),0<(a=t.responses.timestamp-rpsChart.data.labels[rpsChart.data.labels.length-1])&&(rpsStat.textContent=(t.responses.count/a*1e3).toFixed(2),rpsChart.data.datasets[0].data.push(t.responses.count/a*1e3),rpsChart.data.labels.push(t.responses.timestamp)),charts.forEach(function(t){spans[defaultSpan].retention<t.data.labels.length&&(t.data.datasets[0].data.shift(),t.data.labels.shift()),t.update()}))});