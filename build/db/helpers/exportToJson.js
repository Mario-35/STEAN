"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.exportToJson=void 0;const configuration_1=require("../../configuration"),helpers_1=require("../../helpers"),exportToJson=async r=>{const n={create:(0,helpers_1.hidePassword)(configuration_1.serverConfig.getConfig(r.config.name))};var e=Object.keys(r.model).filter(e=>0<r.model[e].createOrder);return e.push(r.model.ThingsLocations.name),await(0,helpers_1.asyncForEach)(e,async o=>{if(Object.keys(r.model[o].columns)&&""!=r.model[o].table){var e=Object.keys(r.model[o].columns).filter(e=>"id"!=e&&!e.endsWith("_id")&&"_"!=e[0]&&""!=r.model[o].columns[e].create);const t=[""];Object.keys(r.model[o].columns).filter(e=>e.endsWith("_id")).forEach(e=>{var o=e.split("_")[0];t.push(`CASE WHEN "${e}" ISNULL THEN NULL ELSE JSON_BUILD_OBJECT('@iot.name', (SELECT REPLACE (name, '''', '''''') FROM "${o}" WHERE "${o}"."id" = ${e} LIMIT 1)) END AS "${e}"`)});e=e.map(e=>(0,helpers_1.addDoubleQuotes)(e)).join(),e=(e.length<=1&&t.shift(),await configuration_1.serverConfig.connection(r.config.name).unsafe(`select ${e}${1<t.length?t.join():""}
 FROM "${r.model[o].table}" LIMIT `+((0,helpers_1.getUrlKey)(r.request.url,"limit")||r.config.nb_page)));n[o]=(0,helpers_1.removeEmpty)(e)}}),delete n.FeaturesOfInterest[0],n};exports.exportToJson=exportToJson;