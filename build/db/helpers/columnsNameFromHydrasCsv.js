"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.columnsNameFromHydrasCsv=void 0;const fs_1=__importDefault(require("fs")),logger_1=require("../../logger"),readline_1=__importDefault(require("readline")),columnsNameFromHydrasCsv=async e=>{var t={header:!1,dateSql:"",columns:[]},r=fs_1.default.createReadStream(e.filename),a=/^[0-9]{2}[\/][0-9]{2}[\/][0-9]{4}$/g,l=/^[0-9]{2}[:][0-9]{2}[:][0-9]{2}$/g,o=/^[0-9]{2}[\/][0-9]{2}[\/][0-9]{4} [0-9]{2}[:][0-9]{2}$/g;for await(const n of readline_1.default.createInterface({input:r,crlfDelay:1/0})){var s=n.split(";");if(1==o.test(s[0])){var u=(n.match(/;/g)||[]).length;t.columns=["datehour"];for(let e=0;e<u;e++)t.columns.push("value"+(e+1));return r.destroy(),t.dateSql=`TO_TIMESTAMP(REPLACE("${e.tempTable}".datehour, '24:00:00', '23:59:59'), 'DD/MM/YYYY HH24:MI:SS')`,t}if(1==a.test(s[0])&&1==l.test(s[1])){var m=(n.match(/;/g)||[]).length;t.columns=["date","hour"];for(let e=0;e<m-1;e++)t.columns.push("value"+(e+1));return r.destroy(),t.dateSql=`TO_TIMESTAMP(concat("${e.tempTable}".date, REPLACE("${e.tempTable}".hour, '24:00:00', '23:59:59')), 'DD/MM/YYYYHH24:MI:SS:MS')`,t}t.header=!0}return t};exports.columnsNameFromHydrasCsv=columnsNameFromHydrasCsv;