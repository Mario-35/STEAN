"use strict";var ArrayOrObject,__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const utils_1=__importDefault(require("./utils")),lexer_1=__importDefault(require("./lexer")),primitiveLiteral_1=__importDefault(require("./primitiveLiteral")),nameOrIdentifier_1=__importDefault(require("./nameOrIdentifier")),expressions_1=__importDefault(require("./expressions"));!function(u){function t(r,t){var i=lexer_1.default.beginArray(r,t);if(i&&i!==t){var l=t,a=(t=i,[]);let e=expressions_1.default.rootExpr(r,t);if(e)for(;e;){a.push(e),t=e.next;var n=lexer_1.default.endArray(r,t);if(!n)return;if(t<n){t=n;break}n=lexer_1.default.valueSeparator(r,t);if(!n||n===t)return;if(t=n,!(e=expressions_1.default.rootExpr(r,t)))return}else{i=lexer_1.default.endArray(r,t);if(!i||i===t)return;t=i}return lexer_1.default.tokenize(r,l,t,{items:a},lexer_1.default.TokenType.Array)}}function i(e,r){return u.stringInJSON(e,r)||u.numberInJSON(e,r)||u.booleanInJSON(e,r)||u.nullInJSON(e,r)}u.complexColInUri=function(r,t){var i=lexer_1.default.beginArray(r,t);if(i&&i!==t){var l=t,a=[];let e=u.complexInUri(r,t=i);if(e)for(;e;){a.push(e),t=e.next;var n=lexer_1.default.endArray(r,t);if(!n)return;if(t<n){t=n;break}n=lexer_1.default.valueSeparator(r,t);if(!n||n===t)return;if(t=n,!(e=u.complexInUri(r,t)))return}else{i=lexer_1.default.endArray(r,t);if(!i||i===t)return;t=i}return lexer_1.default.tokenize(r,l,t,{items:a},lexer_1.default.TokenType.Array)}},u.complexInUri=function(r,t){var i=lexer_1.default.beginObject(r,t);if(i&&i!==t){var l=t,a=[];let e=u.annotationInUri(r,t=i)||u.primitivePropertyInUri(r,t)||u.complexPropertyInUri(r,t)||u.collectionPropertyInUri(r,t)||u.navigationPropertyInUri(r,t);if(e)for(;e;){a.push(e),t=e.next;var n=lexer_1.default.endObject(r,t);if(!n)return;if(t<n){t=n;break}n=lexer_1.default.valueSeparator(r,t);if(!n||n===t)return;if(t=n,!(e=u.annotationInUri(r,t)||u.primitivePropertyInUri(r,t)||u.complexPropertyInUri(r,t)||u.collectionPropertyInUri(r,t)||u.navigationPropertyInUri(r,t)))return}else{i=lexer_1.default.endObject(r,t);if(!i||i===t)return;t=i}return lexer_1.default.tokenize(r,l,t,{items:a},lexer_1.default.TokenType.Object)}},u.collectionPropertyInUri=function(e,r){var t=lexer_1.default.quotationMark(e,r);if(t&&t!==r){var i=r,l=(r=t,nameOrIdentifier_1.default.primitiveColProperty(e,r)||nameOrIdentifier_1.default.complexColProperty(e,r));if(l&&(r=l.next,t=lexer_1.default.quotationMark(e,r))&&t!==r){r=t;t=lexer_1.default.nameSeparator(e,r);if(t&&t!==r){r=t;t=l.type===lexer_1.default.TokenType.PrimitiveCollectionProperty?u.primitiveColInUri(e,r):u.complexColInUri(e,r);if(t)return r=t.next,lexer_1.default.tokenize(e,i,r,{key:l,value:t},lexer_1.default.TokenType.Property)}}}},u.primitiveColInUri=function(r,t){var i=lexer_1.default.beginArray(r,t);if(i&&i!==t){var l=t,a=[];let e=u.primitiveLiteralInJSON(r,t=i);if(e)for(;e;){a.push(e),t=e.next;var n=lexer_1.default.endArray(r,t);if(!n)return;if(t<n){t=n;break}n=lexer_1.default.valueSeparator(r,t);if(!n||n===t)return;if(t=n,!(e=u.primitiveLiteralInJSON(r,t)))return}else{i=lexer_1.default.endArray(r,t);if(!i||i===t)return;t=i}return lexer_1.default.tokenize(r,l,t,{items:a},lexer_1.default.TokenType.Array)}},u.complexPropertyInUri=function(e,r){var t=lexer_1.default.quotationMark(e,r);if(t&&t!==r){var i=r,l=(r=t,nameOrIdentifier_1.default.complexProperty(e,r));if(l&&(r=l.next,t=lexer_1.default.quotationMark(e,r))&&t!==r){r=t;t=lexer_1.default.nameSeparator(e,r);if(t&&t!==r){t=u.complexInUri(e,r=t);if(t)return r=t.next,lexer_1.default.tokenize(e,i,r,{key:l,value:t},lexer_1.default.TokenType.Property)}}}},u.annotationInUri=function(e,r){var t=lexer_1.default.quotationMark(e,r);if(t&&t!==r){var i=r,l=(r=t,lexer_1.default.AT(e,r));if(l){r=l;l=nameOrIdentifier_1.default.namespace(e,r);if(l!==r){var a=r;if(46===e[r=l]){r++;var n=nameOrIdentifier_1.default.termName(e,r);if(n&&(r=n.next,t=lexer_1.default.quotationMark(e,r))&&t!==r){r=t;t=lexer_1.default.nameSeparator(e,r);if(t&&t!==r){t=u.complexInUri(e,r=t)||u.complexColInUri(e,r)||u.primitiveLiteralInJSON(e,r)||u.primitiveColInUri(e,r);if(t)return r=t.next,lexer_1.default.tokenize(e,i,r,{key:"@"+utils_1.default.stringify(e,a,l)+"."+n.raw,value:t},lexer_1.default.TokenType.Annotation)}}}}}}},u.keyValuePairInUri=function(e,r,t,i){var l=lexer_1.default.quotationMark(e,r);if(l&&l!==r){var a=r,t=t(e,r=l);if(t&&(r=t.next,l=lexer_1.default.quotationMark(e,r))&&l!==r){r=l;l=lexer_1.default.nameSeparator(e,r);if(l&&l!==r){i=i(e,r=l);if(i)return r=i.next,lexer_1.default.tokenize(e,a,r,{key:t,value:i},lexer_1.default.TokenType.Property)}}}},u.primitivePropertyInUri=function(e,r){return u.keyValuePairInUri(e,r,nameOrIdentifier_1.default.primitiveProperty,i)},u.navigationPropertyInUri=function(e,r){return u.singleNavPropInJSON(e,r)||u.collectionNavPropInJSON(e,r)},u.singleNavPropInJSON=function(e,r){return u.keyValuePairInUri(e,r,nameOrIdentifier_1.default.entityNavigationProperty,expressions_1.default.rootExpr)},u.collectionNavPropInJSON=function(e,r){return u.keyValuePairInUri(e,r,nameOrIdentifier_1.default.entityColNavigationProperty,t)},u.rootExprCol=t,u.primitiveLiteralInJSON=i,u.stringInJSON=function(r,t){var i=lexer_1.default.quotationMark(r,t);if(i&&i!==t){var l=t;let e=u.charInJSON(r,t=i);for(;e&&e>t;)t=e,e=u.charInJSON(r,t);if((i=lexer_1.default.quotationMark(r,t))&&i!==t)return t=i,lexer_1.default.tokenize(r,l,t,"string",lexer_1.default.TokenType.Literal)}},u.charInJSON=function(e,r){var t,i=lexer_1.default.escape(e,r);return i&&r<i?utils_1.default.equals(e,i,"%2F")?i+3:utils_1.default.equals(e,i,"/")||utils_1.default.equals(e,i,"b")||utils_1.default.equals(e,i,"f")||utils_1.default.equals(e,i,"n")||utils_1.default.equals(e,i,"r")||utils_1.default.equals(e,i,"t")?i+1:utils_1.default.equals(e,i,"u")&&utils_1.default.required(e,i+1,lexer_1.default.HEEDING,4,4)?i+5:!(t=lexer_1.default.escape(e,i))||i<t?t:!(t=lexer_1.default.quotationMark(e,i))||i<t?t:void 0:lexer_1.default.quotationMark(e,r)===r?r+1:void 0},u.numberInJSON=function(e,r){if(e=primitiveLiteral_1.default.doubleValue(e,r)||primitiveLiteral_1.default.int64Value(e,r))return e.value="number",e},u.booleanInJSON=function(e,r){return utils_1.default.equals(e,r,"true")?lexer_1.default.tokenize(e,r,r+4,"boolean",lexer_1.default.TokenType.Literal):utils_1.default.equals(e,r,"false")?lexer_1.default.tokenize(e,r,r+5,"boolean",lexer_1.default.TokenType.Literal):void 0},u.nullInJSON=function(e,r){if(utils_1.default.equals(e,r,"null"))return lexer_1.default.tokenize(e,r,r+4,"null",lexer_1.default.TokenType.Literal)},u.arrayOrObject=function(e,r){var t=u.complexColInUri(e,r)||u.complexInUri(e,r)||u.rootExprCol(e,r)||u.primitiveColInUri(e,r);if(t)return lexer_1.default.tokenize(e,r,t.next,t,lexer_1.default.TokenType.ArrayOrObject)}}(ArrayOrObject=ArrayOrObject||{}),exports.default=ArrayOrObject;